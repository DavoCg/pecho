var _ = require('lodash');
var validator = require('validator');

var requiredFields = {
    places: ['tags', 'distance', 'lat', 'lon'],
    place: ['lat', 'lon']
};

function isValid(query, type){
    var rf = requiredFields[type];
    var isMissingKey =  _.intersection(_.keys(query), rf).length < rf.length;
    var isEmptyProperty = _.some(_.map(_.values(query), function(x){
        return isEmpty(x);
    }));
    return (!isEmptyProperty & !isMissingKey);
}

function formatQuery(query, type){
    if(type === 'place') return query;
    return _.assign(query, {tags: query.tags.split(',')})
}

function isEmpty(x){
    return validator.isNull(x);
}


module.exports = function(query, type){
    if(!isValid(query, type)) return {errorMess: 'Wrong or missing parameter'};
    return formatQuery(query, type);
};
